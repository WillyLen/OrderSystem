@model OrderSystem.Models.OtpEnrollment
@{
    ViewBag.Title = "ShowOtp";
    Layout = "~/Views/Shared/_Auth.cshtml";
}

@section scripts {
    <script>
    var seconds = @Model.expiryTime;
    var countdownElem = document.getElementById('countdown');
    var timer = setInterval(function () {
        seconds--;
        countdownElem.textContent = seconds;
        if (seconds <= 0) {
            clearInterval(timer);
            countdownElem.textContent = "已過期";
            alert("OTP 已過期，請重新取得驗證碼！");
            // 你可以選擇自動刷新或導向其他頁面
            location.href = '@Url.Action("ShowOtp", "Auth", new { sessionId = Model.sessionId })';
        }
    }, 1000);
    </script>
}

@section Title {
    <h1 id="page-title-mainlang" class="pt-tw-text10">OTP 驗證</h1>
    <p id="page-title-sublang" class="">OTP Verification</p>
}

@section Main {
    <div class="d-flex justify-content-center align-items-center mb-5">
        @foreach (var digit in @Model.otpCode.ToString())
        {
            <h1 class="mx-2">@digit</h1> <!-- 加上間距 -->
        }
    </div>
    <div class="d-flex justify-content-center align-items-center mb-5">
        <p>
            驗證碼將在 <span id="countdown" style="color: red">@Model.expiryTime</span> 秒後過期
        </p>
    </div>
    <div class="d-flex justify-content-center align-items-center">
        @using (Html.BeginForm("VerifyOtp", "Auth", FormMethod.Post))
        {
            @Html.Hidden("sessionId", Model.sessionId)
            <div class="d-flex justify-content-between align-items-center mb-5">
                <label for="inputOtp">OTP：</label>
                <input type="text" name="inputOtp" maxlength="6" autofocus required />
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <button type="submit" class="btn btn-primary">驗證</button>
            </div>
        }
    </div>
    <div class="d-flex justify-content-center align-items-center mt-4 pb-2">
        <p>
            <a href="@Url.Action("QrcodeAuth", "Auth", new { sessionId = Model.sessionId })">切換登入方式</a>
        </p>
    </div>
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage as string))
    {
        <div class="alert alert-danger mt-5 d-flex justify-content-center align-items-center" role="alert">
            @ViewBag.ErrorMessage
        </div>
    }
}
